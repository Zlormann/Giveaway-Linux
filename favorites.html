<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />

  <title>Favoris â€” Giveaway Linux</title>
  <meta name="description" content="Tes favoris Giveaway Linux stockÃ©s localement (sans compte). Aucun tracking." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://zlormann.github.io/Giveaway-Linux/favorites.html" />

  <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./css/style.css" />
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <img src="./assets/logo.svg" alt="Logo Giveaway Linux" width="36" height="36" />
        <div>
          <h1>Giveaway Linux</h1>
          <p>â­ Favoris â€” localStorage</p>
        </div>
      </div>

      <nav class="nav">
        <a class="tab" href="./index.html">ğŸ  Accueil</a>
        <a class="tab" href="./discover.html">ğŸ² DÃ©couvrir</a>
        <a class="tab" href="./archive.html">ğŸ—“ Archives</a>
        <a class="tab active" href="./favorites.html" aria-current="page">â­ Favoris</a>
        <a class="tab" href="./rss.xml">ğŸ“¡ RSS</a>
      </nav>
    </header>

    <section class="section">
      <div class="head">
        <h2>â­ Tes favoris</h2>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button id="clear" class="btn">ğŸ§¹ Tout supprimer</button>
        </div>
      </div>
      <div class="body">
        <div id="out" class="note">Chargementâ€¦</div>
      </div>
    </section>

    <footer class="footer">Aucun tracking â€¢ Â© 2026 Giveaway Linux</footer>
  </div>

  <script>
    const BASE = new URL("./", location.href);
    const KEY = "gl_favorites_v1";
    const esc = s => String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");

    async function loadJSON(p){
      const r = await fetch(new URL(p, BASE), {cache:"no-store"});
      if(!r.ok) throw new Error("HTTP " + r.status + " : " + p);
      return r.json();
    }

    function getFavs(){
      try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
      catch { return []; }
    }
    function setFavs(arr){
      localStorage.setItem(KEY, JSON.stringify(arr));
    }

    function row(item){
      return `
        <div class="card">
          <div class="inner">
            <div class="muted"><b>${esc(item.kind)}</b></div>
            <h3>${esc(item.name)}</h3>
            <div class="tags"><span class="tag">${esc(item.meta || "")}</span></div>
            <div class="links">
              <a class="btn primary" target="_blank" rel="noopener" href="${esc(item.url)}">â¬‡ Ouvrir</a>
              <button class="btn" data-del="${esc(item.id)}">ğŸ—‘ Retirer</button>
            </div>
          </div>
        </div>
      `;
    }

    async function render(){
      const out = document.getElementById("out");
      const favIds = getFavs();

      if(favIds.length === 0){
        out.className = "note";
        out.textContent = "Aucun favori pour lâ€™instant. Ajoute-en depuis DÃ©couvrir.";
        return;
      }

      try{
        const [soft, games] = await Promise.all([
          loadJSON("data/software.json"),
          loadJSON("data/games.json")
        ]);

        const list = [];
        favIds.forEach(id => {
          // id format: "software:xxx" or "game:xxx" (comme discover.html)
          const [kind, raw] = String(id).split(":");
          if(kind === "software"){
            const s = soft.find(x => x.id === raw);
            if(s) list.push({id, kind:"ğŸ§© Logiciel", name:s.name, meta:s.category, url:(s.url||s.download_url||s.home_url)});
          }else if(kind === "game"){
            const g = games.find(x => x.id === raw);
            if(g) list.push({id, kind:"ğŸ® Jeu", name:g.name, meta:g.genre, url:(g.url||g.download_url||g.home_url)});
          }
        });

        if(list.length === 0){
          out.className = "note";
          out.textContent = "Favoris vides ou anciens IDs non trouvÃ©s. Re-fais des favoris depuis DÃ©couvrir.";
          return;
        }

        out.className = "";
        out.innerHTML = list.map(row).join('<div style="height:12px"></div>');

        out.querySelectorAll("[data-del]").forEach(b=>{
          b.addEventListener("click", ()=>{
            const id = b.getAttribute("data-del");
            setFavs(getFavs().filter(x => x !== id));
            render();
          });
        });
      }catch(err){
        out.className = "danger";
        out.textContent = "Erreur : " + (err.message || err);
      }
    }

    document.getElementById("clear").addEventListener("click", ()=>{
      setFavs([]);
      render();
    });

    render();
  </script>
</body>
</html>
