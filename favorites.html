<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Giveaway Linux ‚Äî Favoris</title>
  <meta name="description" content="Tes favoris Giveaway Linux (stock√©s localement, sans compte)." />
  <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <img src="./assets/logo.svg" alt="Logo Giveaway Linux">
        <div>
          <h1>‚≠ê Mes favoris</h1>
          <p>Stock√©s sur ton navigateur (localStorage) ‚Ä¢ aucun compte</p>
        </div>
      </div>
      <nav class="nav">
        <a class="tab" href="./index.html">Accueil</a>
        <a class="tab" href="./archive.html">Archives</a>
        <a class="tab active" href="./favorites.html">Favoris</a>
        <a class="tab" href="./submit.html">Proposer</a>
        <a class="tab" href="./about.html">√Ä propos</a>
        <a class="tab" href="./rss.xml">RSS</a>
      </nav>
    </header>

    <section class="section">
      <div class="head">
        <h2>‚≠ê Tes favoris</h2>
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
          <a class="btn" href="./index.html">‚Üê Retour</a>
          <button class="btn" id="clearFavs" type="button">üßπ Vider</button>
        </div>
      </div>
      <div class="body">
        <div class="note">
          Les favoris restent sur ce navigateur m√™me si tu reviens plus tard.
        </div>

        <div style="height:12px"></div>
        <div id="favList"></div>
      </div>
    </section>

    <div class="footer">¬© 2026 ‚Äî Giveaway Linux</div>
  </div>

  <script type="module">
    import { loadFavs, clearFavs } from "./js/favs.js";

    const $ = (s) => document.querySelector(s);

    async function loadJSON(path){
      const res = await fetch(path, { cache: "no-store" });
      if(!res.ok) throw new Error("Erreur chargement " + path);
      return res.json();
    }

    function linkHTML(label, url){
      if(!url) return "";
      return `<a class="link" href="${url}" target="_blank" rel="noopener noreferrer">${label}</a>`;
    }

    function cardHTML(item, typeLabel){
      const title = item.title || item.name || "‚Äî";
      const desc = item.shortDesc || item.desc || "";
      const L = item.links || {};
      return `
        <article class="card">
          <div class="inner">
            <div class="muted"><b>${typeLabel}</b></div>
            <h3 style="margin:6px 0 8px">${title}</h3>
            <div class="muted">${desc}</div>
            <div class="links" style="margin-top:10px">
              ${linkHTML("T√©l√©charger", L.download)}
              ${linkHTML("Site officiel", L.official)}
              ${linkHTML("Flathub", L.flathub)}
              ${linkHTML("Steam", L.steam)}
              ${linkHTML("itch.io", L.itch)}
            </div>
          </div>
        </article>
      `;
    }

    function renderFavs(catalog){
      const box = $("#favList");
      const ids = loadFavs();

      if(ids.length === 0){
        box.innerHTML = `<div class="note">Aucun favori pour l‚Äôinstant. Va sur l‚Äôaccueil et clique sur ‚≠ê.</div>`;
        return;
      }

      const map = new Map();
      (catalog.apps||[]).forEach(a => map.set(a.id, { ...a, _type:"üß© Logiciel" }));
      (catalog.games||[]).forEach(g => map.set(g.id, { ...g, _type:"üéÆ Jeu" }));

      const items = ids.map(id => map.get(id)).filter(Boolean);

      if(items.length === 0){
        box.innerHTML = `<div class="note">Tes favoris ne sont plus dans le catalogue (ids modifi√©s).</div>`;
        return;
      }

      box.innerHTML = `
        <div class="grid2">
          ${items.map(it => cardHTML(it, it._type)).join("")}
        </div>
        <div style="height:10px"></div>
        <div class="muted">Astuce : clique sur ‚≠ê dans les r√©sultats de recherche ou sur l‚Äôaccueil pour ajouter/retirer.</div>
      `;
    }

    (async ()=>{
      const catalog = await loadJSON("./data/catalog.json");
      renderFavs(catalog);

      $("#clearFavs").addEventListener("click", ()=>{
        clearFavs();
        renderFavs(catalog);
      });
    })();
  </script>
</body>
</html>
