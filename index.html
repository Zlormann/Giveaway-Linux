<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Giveaway Linux ‚Äî S√©lection du jour</title>

  <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg">
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;max-width:980px;margin:40px auto;padding:0 16px;line-height:1.4}
    header{display:flex;gap:14px;align-items:center;margin-bottom:18px}
    header img{width:56px;height:56px}
    nav a{margin-right:12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:18px}
    .card{border:1px solid #ddd;border-radius:12px;padding:14px}
    .muted{color:#666}
    .btn{display:inline-block;padding:10px 12px;border-radius:10px;border:1px solid #ccc;text-decoration:none}
    .ok{color:#0a7a2f}
    .warn{color:#b45309}
    .err{color:#b91c1c;white-space:pre-wrap}
    footer{margin-top:28px;color:#666;font-size:14px}
    code{background:#f6f6f6;padding:2px 6px;border-radius:6px}
    @media (max-width:800px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <img src="./assets/logo.svg" alt="Logo Giveaway Linux" onerror="this.style.display='none'">
    <div>
      <h1 style="margin:0">Giveaway Linux</h1>
      <div class="muted">1 logiciel + 1 jeu gratuits ‚Ä¢ s√©lection quotidienne</div>
    </div>
  </header>

  <nav>
    <a href="./index.html">Accueil</a>
    <a href="./archive.html">Archives</a>
    <a href="./about.html">√Ä propos</a>
    <a href="./submit.html">Proposer</a>
    <a href="./rss.xml">RSS</a>
  </nav>

  <div class="card" id="status" style="margin-top:16px">
    <div class="warn">Chargement des donn√©es‚Ä¶</div>
    <div class="muted">Si √ßa reste bloqu√©, c‚Äôest un souci de chemin. Les fichiers attendus sont : <code>./data/picks.json</code> <code>./data/software.json</code> <code>./data/games.json</code></div>
  </div>

  <section class="grid">
    <div class="card">
      <h2 style="margin-top:0">üß© Logiciel</h2>
      <div id="softBox" class="muted">‚Äî</div>
    </div>
    <div class="card">
      <h2 style="margin-top:0">üéÆ Jeu</h2>
      <div id="gameBox" class="muted">‚Äî</div>
    </div>
  </section>

  <footer>
    ‚úÖ Liens officiels uniquement ‚Ä¢ ‚úÖ Aucun tracking ‚Ä¢ ‚úÖ Projet communautaire<br>
    <span class="muted">Donn√©es publiques : <code>/data/*.json</code></span>
  </footer>

<script>
(async () => {
  const $status = document.getElementById('status');
  const $soft = document.getElementById('softBox');
  const $game = document.getElementById('gameBox');

  function esc(s){ return String(s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function link(url, label){
    if(!url) return '';
    const safe = String(url);
    return `<div style="margin-top:10px"><a class="btn" href="${esc(safe)}" target="_blank" rel="noopener noreferrer">${esc(label)}</a></div>`;
  }

  async function getJSON(path){
    const r = await fetch(path, { cache: "no-store" });
    if(!r.ok) throw new Error(`HTTP ${r.status} sur ${path}`);
    return r.json();
  }

  try {
    // Chemins s√ªrs pour GitHub Pages
    const picks = await getJSON('./data/picks.json');
    const software = await getJSON('./data/software.json');
    const games = await getJSON('./data/games.json');

    // On prend la derni√®re s√©lection si c‚Äôest une liste, sinon l‚Äôobjet direct
    const pick = Array.isArray(picks) ? picks[picks.length - 1] : (picks.today || picks);

    const softId = pick.software_id || pick.software || pick.softwareId;
    const gameId = pick.game_id || pick.game || pick.gameId;

    const soft = Array.isArray(software) ? software.find(x => x.id === softId) : software[softId];
    const game = Array.isArray(games) ? games.find(x => x.id === gameId) : games[gameId];

    $status.innerHTML = `<div class="ok">‚úÖ Donn√©es charg√©es.</div>
      <div class="muted">S√©lection : <code>${esc(pick.date || pick.day || 'aujourd‚Äôhui')}</code></div>`;

    if(soft){
      $soft.innerHTML = `
        <h3 style="margin:0 0 6px 0">${esc(soft.name || soft.title)}</h3>
        <div class="muted">${esc(soft.description || '')}</div>
        ${link(soft.url || soft.link, 'T√©l√©charger (lien officiel)')}
      `;
    } else {
      $soft.textContent = "Aucun logiciel trouv√© (ID manquant ou non pr√©sent dans software.json).";
    }

    if(game){
      $game.innerHTML = `
        <h3 style="margin:0 0 6px 0">${esc(game.name || game.title)}</h3>
        <div class="muted">${esc(game.description || '')}</div>
        ${link(game.url || game.link, 'T√©l√©charger (lien officiel)')}
      `;
    } else {
      $game.textContent = "Aucun jeu trouv√© (ID manquant ou non pr√©sent dans games.json).";
    }

  } catch (e) {
    $status.innerHTML = `<div class="err">‚ùå Erreur : ${esc(e.message)}</div>
    <div class="muted" style="margin-top:8px">
      V√©rifie que ces fichiers existent exactement (m√™mes noms) :
      <ul>
        <li><code>/data/picks.json</code></li>
        <li><code>/data/software.json</code></li>
        <li><code>/data/games.json</code></li>
      </ul>
      Et recharge avec <b>Ctrl+F5</b>.
    </div>`;
    console.error(e);
    <a href="rss.xml">RSS</a>
  }
})();
</script>
</body>
</html>
