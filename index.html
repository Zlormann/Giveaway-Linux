<script>
(async () => {
  try {
    const picksRes = await fetch("data/picks.json", { cache: "no-store" });
    const picksJson = await picksRes.json();
    const pick = Array.isArray(picksJson) ? picksJson[0] : picksJson;

    // Si picks.json contient d√©j√† software/game complets, on les prend
    let software = pick.software;
    let game = pick.game;

    // Sinon on charge les listes et on retrouve via ID
    if (!software || !game) {
      const [softRes, gameRes] = await Promise.all([
        fetch("data/software.json", { cache: "no-store" }),
        fetch("data/games.json", { cache: "no-store" })
      ]);
      const softwareList = await softRes.json();
      const gamesList = await gameRes.json();

      const softwareId = pick.software_id;
      const gameId = pick.game_id;

      software = softwareList.find(s => (s.id || "").toLowerCase() === String(softwareId || "").toLowerCase());
      game = gamesList.find(g => (g.id || "").toLowerCase() === String(gameId || "").toLowerCase());
    }

    const c = document.getElementById("content");

    const softName = software?.name || "‚Äî";
    const softDesc = software?.description || software?.category || "Aucun logiciel trouv√©.";
    const softUrl  = software?.download_url || software?.home_url || software?.url || "#";

    const gameName = game?.name || "‚Äî";
    const gameDesc = game?.description || game?.genre || "Aucun jeu trouv√©.";
    const gameUrl  = game?.download_url || game?.home_url || game?.url || "#";

    c.innerHTML = `
      <div class="card">
        <h2>üõ†Ô∏è Logiciel du jour</h2>
        <strong>${softName}</strong>
        <p>${softDesc}</p>
        <a href="${softUrl}" target="_blank" rel="noopener noreferrer">‚¨á T√©l√©charger</a>
      </div>

      <div class="card">
        <h2>üéÆ Jeu du jour</h2>
        <strong>${gameName}</strong>
        <p>${gameDesc}</p>
        <a href="${gameUrl}" target="_blank" rel="noopener noreferrer">‚¨á T√©l√©charger</a>
      </div>
    `;
  } catch (e) {
    document.getElementById("content").innerText =
      "Impossible de charger la s√©lection.";
    console.error(e);
  }
})();
</script>
